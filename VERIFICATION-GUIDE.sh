#!/bin/bash
# Verification Guide: How to Check if OpenCode is Using Your Config

# Detect current directory and user
REPO_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
OPENCODE_DIR="$REPO_DIR/opencode"

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ” How to Verify OpenCode is Using Your Configuration"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 1: Check OpenCode Startup Output"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "When you start OpenCode, look for these messages:"
echo ""
echo "âœ“ Skills discovered:"
echo "  Loading skills from .opencode/skill/"
echo "  â€¢ team-review"
echo "  â€¢ deploy-check"
echo "  â€¢ security-audit"
echo "  â€¢ branch"
echo "  â€¢ commit"
echo "  â€¢ push"
echo "  â€¢ create-pr"
echo ""
echo "âœ“ Agents discovered:"
echo "  Loading agents from .opencode/agent/"
echo "  â€¢ code-reviewer"
echo "  â€¢ test-writer"
echo ""
echo "âœ“ Commands discovered:"
echo "  Loading commands from .opencode/command/"
echo "  â€¢ review"
echo "  â€¢ test"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 2: Use OpenCode's Built-in Help"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "In OpenCode, type:"
echo ""
echo "  /help"
echo ""
echo "This shows all available commands/skills including your custom ones."
echo ""
echo "Look for these slash commands:"
echo "  /team-review      - Review code for team standards"
echo "  /deploy-check     - Pre-deployment checklist"
echo "  /security-audit   - Security vulnerability scanning"
echo "  /review           - Custom review command"
echo "  /test             - Custom test command"
echo ""
echo "Note: Git workflow skills (branch, commit, push, create-pr) are"
echo "triggered by natural language like 'create a branch' or 'commit my changes'"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 3: Check the Skill Tool Description"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Ask OpenCode:"
echo ""
echo "  \"what skills are available?\""
echo ""
echo "OpenCode should respond with:"
echo "  â€¢ team-review - Review code for team standards"
echo "  â€¢ deploy-check - Pre-deployment checklist"
echo "  â€¢ security-audit - Security vulnerability scanning"
echo "  â€¢ branch - Create a new branch"
echo "  â€¢ commit - Commit changes with good message"
echo "  â€¢ push - Push to remote"
echo "  â€¢ create-pr - Create a pull request"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 4: Check Agent Autocomplete"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "In OpenCode, type: @"
echo ""
echo "You should see autocomplete suggestions:"
echo "  @code-reviewer    - Custom agent"
echo "  @test-writer      - Custom agent"
echo "  @general          - Built-in agent"
echo "  @explore          - Built-in agent"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 5: Test a Skill Directly"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Try using a skill with a slash command:"
echo ""
echo "  /team-review"
echo ""
echo "Or ask naturally:"
echo ""
echo "  \"review this code using team standards\""
echo "  \"create a branch for my feature\""
echo "  \"commit my changes\""
echo ""
echo "âœ“ If it works:"
echo "  OpenCode will follow the skill's instructions"
echo "  For named skills, you'll see them execute"
echo ""
echo "âœ— If it doesn't work:"
echo "  Error: \"Skill 'team-review' not found\""
echo "  â†’ Skills not loaded, check configuration"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 6: Check OpenCode Config Location"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Ask OpenCode:"
echo ""
echo "  \"where are you looking for skills?\""
echo ""
echo "OpenCode should respond with paths like:"
echo "  â€¢ $OPENCODE_DIR/.opencode/skill/"
echo "  â€¢ ~/.config/opencode/skill/"
echo "  â€¢ .claude/skills/ (compatibility)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "METHOD 7: Enable Debug Mode"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Start OpenCode with debug output:"
echo ""
echo "  DEBUG=* opencode"
echo ""
echo "or"
echo ""
echo "  opencode --verbose"
echo ""
echo "Look for lines like:"
echo "  [DEBUG] Loading skill: team-review"
echo "  [DEBUG] Loading agent: code-reviewer"
echo "  [DEBUG] Loading command: review"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "UNDERSTANDING SKILLS: Named vs Natural Language"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Skills can be invoked in different ways:"
echo ""
echo "ğŸ“Œ Skills WITH 'name:' field (appear as slash commands):"
echo "  â€¢ team-review      â†’ Use: /team-review"
echo "  â€¢ deploy-check     â†’ Use: /deploy-check"
echo "  â€¢ security-audit   â†’ Use: /security-audit"
echo ""
echo "ğŸ“Œ Skills WITHOUT 'name:' field (triggered by natural language):"
echo "  â€¢ branch           â†’ Say: \"create a branch for my feature\""
echo "  â€¢ commit           â†’ Say: \"commit my changes\""
echo "  â€¢ push             â†’ Say: \"push to remote\""
echo "  â€¢ create-pr        â†’ Say: \"create a pull request\""
echo ""
echo "ğŸ“Œ Commands (from .opencode/command/ directory):"
echo "  â€¢ review.md        â†’ Use: /review"
echo "  â€¢ test.md          â†’ Use: /test"
echo ""
echo "ğŸ’¡ Best Practice:"
echo "Add 'name:' field to SKILL.md frontmatter if you want slash command support."
echo ""
echo "Example:"
echo "  ---"
echo "  name: branch"
echo "  description: Create a new branch"
echo "  ---"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "VERIFICATION CHECKLIST"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Run these tests in order:"
echo ""
echo "1. [ ] Started OpenCode in $OPENCODE_DIR"
echo "2. [ ] Saw \"Loading skills\" message on startup"
echo "3. [ ] /help shows slash commands (/team-review, /deploy-check, /security-audit, /review, /test)"
echo "4. [ ] @ shows custom agents (code-reviewer, test-writer)"
echo "5. [ ] /team-review works OR 'review this code' triggers skill"
echo "6. [ ] @code-reviewer responds"
echo "7. [ ] Natural language like 'create a branch' works"
echo ""
echo "If ALL are âœ“ â†’ Configuration is loaded and working!"
echo "If ANY are âœ— â†’ See troubleshooting below"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "TROUBLESHOOTING: Configuration Not Loading"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âŒ PROBLEM: Skills not showing up"
echo ""
echo "CHECK 1: Are you in the right directory?"
echo "  pwd should show: $OPENCODE_DIR"
echo ""
echo "CHECK 2: Does .opencode/ exist?"
echo "  ls -la | grep .opencode"
echo ""
echo "CHECK 3: Are SKILL.md files in correct location?"
echo "  find .opencode -name \"SKILL.md\""
echo "  Should show: .opencode/skill/*/SKILL.md"
echo ""
echo "CHECK 4: Check SKILL.md frontmatter"
echo "  cat .opencode/skill/team-review/SKILL.md | head -10"
echo "  Must have: name: and description:"
echo ""
echo "CHECK 5: Restart OpenCode"
echo "  Exit and restart: opencode"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "QUICK DIAGNOSTIC SCRIPT"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Run this to diagnose issues:"
echo ""
cat << 'DIAGNOSTIC'
#!/bin/bash
echo "ğŸ” OpenCode Configuration Diagnostic"
echo ""
echo "Current directory:"
pwd
echo ""
echo ".opencode directory exists?"
if [ -d ".opencode" ]; then
    echo "âœ“ Yes"
else
    echo "âœ— No - create it!"
fi
echo ""
echo "Skills found:"
find .opencode -name "SKILL.md" 2>/dev/null | wc -l
echo ""
echo "Agents found:"
find .opencode/agent -name "*.md" 2>/dev/null | wc -l
echo ""
echo "Commands found:"
find .opencode/command -name "*.md" 2>/dev/null | wc -l
echo ""
echo "Checking skill frontmatter:"
for skill in .opencode/skill/*/SKILL.md; do
    echo "  File: $skill"
    grep -E "^name:|^description:" "$skill" | head -2
    echo ""
done
DIAGNOSTIC
echo ""

echo "Save this as 'diagnostic.sh' and run it"
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ¯ VISUAL INDICATORS THAT IT'S WORKING"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "When configuration IS loaded, you'll see:"
echo ""
echo "1. Startup Messages:"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ OpenCode v1.x.x                     â”‚"
echo "   â”‚ Loading skills from .opencode/...   â”‚"
echo "   â”‚ â€¢ team-review                       â”‚"
echo "   â”‚ â€¢ deploy-check                      â”‚"
echo "   â”‚ â€¢ security-audit                    â”‚"
echo "   â”‚ â€¢ branch                            â”‚"
echo "   â”‚ â€¢ commit                            â”‚"
echo "   â”‚ â€¢ push                              â”‚"
echo "   â”‚ â€¢ create-pr                         â”‚"
echo "   â”‚ Ready!                              â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "2. Skill Invocation Works:"
echo "   You: /team-review"
echo "   OR: \"review this code using team standards\""
echo "   OpenCode: [Executes skill instructions]"
echo ""
echo "3. Agent Invocation Works:"
echo "   You: @code-reviewer review this"
echo "   OpenCode: [Invokes subagent with restrictions]"
echo ""
echo "4. Command Autocomplete:"
echo "   You: /"
echo "   OpenCode shows: /team-review, /deploy-check, /security-audit, /review, /test"
echo ""
echo "5. Natural Language Triggers:"
echo "   You: \"create a branch for authentication\""
echo "   OpenCode: [Creates branch using branch skill]"
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Ready to verify? Start OpenCode and check each method!"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
